---
title: 新生导师分配系统
date: 2025-03-31
description: 基于多规则优先级的智能学生小组分配系统
cover: /images/example-cover.png
tags:
  - Python
  - 数据自动化#4A90E2
  - Excel 导出#2ECC71
abbrlink: 61b78776
---

# 新生导师分配系统（Mentor Matching Tool for New Students）

## 项目背景

该系统目的是为某海外高校新生导师项目提供智能分配支持。每年新生入学前需分配至不同小组，由学生导师负责对接、答疑和管理。原有人工方式效率低、错误率高，本系统旨在自动完成小组分配，并生成结构清晰的 Excel 表格。

## 项目挑战

在项目初期，我面临几个主要挑战：
1. 如何确保分配结果公平合理？
2. 如何处理大规模数据？
3. 如何应对各种异常情况？
4. 如何平衡多个维度的优先级与约束关系？

## 核心目标

- 基于国籍、本地/国际学生、签证状态、专业信息等维度进行多级优先匹配
- 每个学生导师分配到人数平衡的小组
- 分组结果可导出为符合格式的多 Sheet Excel 文件
- 系统可根据需求调整输出结构，如新增统计 Sheet、勾选列、序号列等

## 功能概览

### 🎯 分配逻辑

系统实现了一套**优先级规则链**，在满足各项业务约束的前提下尽可能自动完成最优分配：

1. **本地/国际生区分**：国际学生中的中国大陆国籍的学生分配至微信组，其他非中国大陆的学生分配至WhatsApp组，本地学生分配至WhatsApp组
2. **签证状态判断**：只将已下签的学生分配到各个小组中，未下签的学生列表将被单独整理在Pending的独立Sheet中，方便项目管理人员查阅
3. **专业聚类**：同专业学生尽量集中在同组，确保话题相关性
4. **Local 例外处理**：若某组仅分配到 1 位 Local 学生，系统自动调整至 ≥2 或归并其他组
5. **总人数保底检查**：确保每位学生都被成功分配，无数据丢失

### 📦 报表导出（Excel）

借助 `openpyxl` 实现多种表格导出特性：

- **组别划分 Sheet**：WX、WA 分别导出为各自 Sheet，并按 mentor 编排
- **Pending 单独列出**：未下签的国际学生将被导出至 Pending Sheet
- **自动命名 Sheet**：根据 mentor group 前缀自动重命名（如 AEP-WX）
- **组内编号**：每组成员自动添加顺序编号列 `No.`
- **复选框列**：添加 Attended 列用于勾选签到（兼容 Excel 预设样式）
- **空白行留白**：每组结尾自动预留两个空白行，便于手动补充
- **最终统计页**：自动生成 `Report` Sheet，汇总分配结果、警告项、统计项等内容，支持查阅调试

## 技术实现

### 技术栈

- **语言**：Python 3.10
- **数据处理**：pandas, NumPy
- **表格导出**：openpyxl
- **运行方式**：命令行脚本，支持 Windows 环境本地运行

### 项目结构

| 文件 | 功能 |
|------|------|
| `loader.py` | 数据清洗与字段标准化（如 Title → Gender、判断是否 Local） |
| `assigner.py` | 分配核心逻辑，包含分组算法与规则链处理 |
| `exporter.py` | 多 Sheet 导出，含自动命名、样式处理、统计表 |
| `main.py` | 主流程入口，执行加载 → 分配 → 导出全流程 |

### 实现片段（已脱敏）

```python
# Step 1: shuffle 所有学生
all_students = students_df.sample(frac=1).to_dict(orient='records')
pending_pool = [s for s in all_students if s['*status'] == 'Pending']
granted_pool = [s for s in all_students if s['*status'] == 'Granted']
local_pool = [s for s in all_students if s['*status'] == 'Local']

# Step 2: 分别轮询分配
round_robin_distribute(granted_pool)
round_robin_distribute(pending_pool)
round_robin_distribute(local_pool)
```

```python
# Step 3: 若组内 Local 数仅为 1，强制归并
for group in mentor_pool:
    local_in_group = [s for s in group if s['*status'] == 'Local']
    if len(local_in_group) == 1:
        # 移除并后续归并
```

## 项目成果

### 效率提升
系统上线后，分配时间从原来的数小时减少到数分钟，准确率达到99%以上。用户反馈显示，系统不仅提高了工作效率，还大大减少了人为错误。

### 质量保证
通过自动化验证机制和完整的错误处理，系统能够保证分配结果的质量。每个分配结果都可以追溯，方便后续查询和调整。

### 用户反馈
用户对系统的评价主要集中在以下几个方面：
- 操作简单直观
- 结果清晰可读
- 支持批量处理

## 技术难点

### 1. 大规模数据处理
在处理大规模数据时，我遇到了性能瓶颈。通过分析，我发现主要问题在于数据结构的选择。最终，我通过优化数据结构和实现分块处理，成功解决了这个问题。

### 2. 分配公平性
确保分配结果公平是一个重要挑战。我设计了一套评分机制，从多个维度评估分配结果，并通过动态平衡算法不断优化。

### 3. 异常处理
在系统运行过程中，各种异常情况时有发生。我设计了一套完整的异常处理机制，包括错误捕获、智能恢复和日志记录，确保系统稳定运行。

## 项目价值

### 业务价值
系统上线后，显著提高了工作效率，减少了人为错误，优化了资源配置。用户反馈显示，系统大大减轻了工作负担。

### 技术价值
在开发过程中，我积累了丰富的算法实践和工程化经验。特别是在处理大规模数据和设计复杂算法方面，有了很大提升。

### 社会价值
系统的成功应用，不仅提高了教育管理效率，还促进了教育公平，推动了教育机构的数字化转型。

## 经验总结

### 技术方面
通过这个项目，我深刻认识到：
- 深入理解业务需求的重要性
- 合理选择技术方案的必要性
- 注重代码质量的长期价值
- 熟练掌握 `pandas` 多条件筛选与数据处理技巧
- 运用 `openpyxl` 实现 Excel 表格的结构化、美观化输出
- 构建可复用的分配引擎，支持规则权重扩展与兜底逻辑补全

### 管理方面
在项目管理上，我学会了：
- 及时与用户沟通反馈
- 灵活调整开发方案
- 重视用户体验
- 实战理解真实业务需求中的"规则模糊性"与"优先级冲突"
- 构建配置灵活的输出系统，兼顾自动化与人工后期介入

### 未来展望
展望未来，我计划：
- 支持更多分配规则
- 优化算法效率
- 扩展应用场景
- 在多轮需求迭代中保持代码可维护性与结构清晰

这个项目不仅解决了一个实际问题，也让我在技术和管理方面都有了很大提升。我相信，这些经验对未来的项目开发都会很有帮助。
